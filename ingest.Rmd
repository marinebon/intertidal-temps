---
title: "ingest"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = F, warning = F)
```

## TODO

1. PROBLEM. Data is too big for simple interactive time-series plot (ie dygraphs) if on same Rmd output html page. The folder of *.csv's [robomusseldata20201030 - Google Drive](https://drive.google.com/drive/u/3/folders/1kzjZ72vFxRGsafTgCCzq6cXIhQ1GYQa3) contains 317 files totalling 236 MB. SOLUTION(s):
    1. Read into SQLite database and show as Shiny app.


## Ingest single txt

```{r}
# libraries
if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}
shelf(
  # time-series
  dygraphs, xts,
  # tidyverse
  tidyverse, lubridate)

# paths & variables
user <- Sys.info()[["user"]]
dir_data <- case_when(
  user == "bbest"       ~ "/Users/bbest/Downloads/robomusseldata20201030",
    # on Ben's laptop Gdrive path
    # "/Volumes/GoogleDrive/My Drive/projects/mbon-p2p/data/rocky/MARINe/robomusseldata20201030",
  user == "cdobbelaere" ~ "/Users/cdobbelaere/Documents/project/robomusseldata20201030")

# TODO: iterate over files in dir_data

# path individual tab-seperated value (*.tsv) file
tsv <- file.path(dir_data, "BMRMUSCABD3_2012.txt")

# read data from 
d <- read_tsv(tsv) %>% 
  mutate(
    time = parse_date_time(d$Time_GMT, "m/d/y H:M")) %>% 
  select(-Time_GMT) %>% 
  arrange(time) # d

# convert to eXtensible Time Series for dygraph
x <- d 
x <- xts(select(x, -time), order.by=x$time)

# output dygraph interactive plot
dygraph(x, main="Temp_C") %>%
  dyOptions(
    colors = "red",
    fillGraph = TRUE, fillAlpha = 0.4) %>% 
  dyRangeSelector()
```


